= content_for :breadcrumb do
  = render :partial => "layouts/crumb", :object => [           |
      link_to(t('administration'), :controller => "admin", :action => "index"), |
      link_to(t(:experiments_header), experiments_path),                |
      link_to(@experiment.name,experiment_sessions_path(@experiment)), |
      t(:sessions_label)]


= render :partial => "experiments/enrollment"

%h1
  = @experiment.name


= render :partial => "experiments/tabs", :locals => {:selected => :sessions}


- if current_user.has_right?(@experiment, 'manage_sessions')
  = link_to t('sessions.new_session_link'), new_experiment_session_path(@experiment), :class => "btn btn-primary"

//= @ungrouped_sessions.inspect
//= @grouped_sessions.inspect
//= @session_groups.inspect

- if (@experiment.session_groups.size > 0)
  %br
  %br
  Group mode:
  .btn-group
    - mode = @experiment.session_groups.first.signup_mode
    = link_to t('sessions.mode.singular'), update_mode_experiment_sessions_path(@experiment, :mode => SessionGroup::USER_VISITS_ONE_SESSION_OF_GROUP), :class => "btn btn-default #{ mode == 1 ? 'active' : ''}", :method => :post
    = link_to t('sessions.mode.random'), update_mode_experiment_sessions_path(@experiment, :mode => SessionGroup::USER_VISITS_ALL_SESSIONS_OF_GROUP), :class => "btn btn-default #{ mode == 2 ? 'active' : ''}", :method => :post
    = link_to t('sessions.mode.all'), update_mode_experiment_sessions_path(@experiment, :mode => SessionGroup::USER_IS_RANDOMIZED_TO_ONE_SESSION), :class => "btn btn-default #{ mode == 3 ? 'active' : ''}", :method => :post
  = t(".explanation#{mode}")
  %br
  %br

  //TODO extra loop seems like a messy solution, could eliminate at bane of more database calls.
//TODO make these ruby comments..
//Populate map.
- human_friendly_group_id = 0
- @grouped_sessions.each do |group, sessions|
  -@human_to_database_group_ids[human_friendly_group_id += 1] = group


  %h4
    Ungrouped sessions

%table.table
  - human_friendly_group_id = 0
  - @ungrouped_sessions.each do |session|
    = render :partial => 'line', :locals => {:session => session, :human_friendly_group_id => human_friendly_group_id += 1}

- @grouped_sessions.each do |group, sessions|

  %h4
    Group

  %table.table
    - sessions.each do |session|
      = render :partial => 'line', :locals => {:session => session}

= @human_to_database_group_ids.inspect
