- if edit
  = render :partial => 'form', :locals => {:session => session, :subsession => subsession}  
-else
  %div{:id => "session"+session.id.to_s, :class => 'sessionline '+(subsession ? 'subsession' : '')}
  
    

    
    .right-col

      .btn-group
        =link_to "Bearbeiten", edit_experiment_session_path(@experiment, session), :class => 'session_edit btn btn-primary'
        %a.btn.dropdown-toggle{:'data-toggle' => "dropdown", :href => "#"}
          Aktionen
          %b.caret
        %ul.dropdown-menu
          - unless subsession
            %li= link_to 'Folgesession', new_experiment_session_path(:experiment_id => @experiment, :reference_session_id => session.id), :class => "session_new_subsession"
          %li= link_to "Duplizieren", duplicate_experiment_session_path(@experiment, session), :class => 'session_duplicate'
          %li= link_to "Löschen", experiment_session_path(@experiment, session), :class => 'session_delete', :confirm => "Soll diese Session wirklich gelöscht werden?"

  
          
      
    %span.time{:class => if session.end_at < Time.zone.now then "past" end}
       
      = '+' if subsession
      = session.time_str
  
    .room
      =truncate(session.location.name, :length => 30) if session.location
      
    - r = subsession ? session.reference_session : session
    
    .participants
      - surplus = r.session_participations.count - r.needed

      - css_class = if surplus < 0 then |
          "participants-red"            |
        elsif surplus < r.reserve then  |
          "participants-yellow"         |
        else                            |
          "participants-green"          |
        end                             |
      = link_to "Teilnehmer: #{r.session_participations.count} (#{r.needed},#{r.reserve})#{", Gruppengröße: "+session.group_size.to_s if session.group_size}", participants_experiment_session_path(@experiment, session), :class => css_class
      
      - if session.end_at < Time.zone.now then
        - if session.session_participations.where('showup=0 AND participated=0 AND noshow=0').count > 0
          %span.session-warning
            Teilnahmeliste noch nicht vollständig
      
