.filter
  Suche in Name, Vorname, E-Mail-Adresse:
  %br
  = text_field_tag :search, params[:search] 
  %br
  %br

  Filter: 

  - { 'gender' => 'Geschlecht', 'noshow' => 'Nichterscheinen', 'register' => 'Anmeldungen', 'begin' => 'Studienbeginn', |
      'study' => 'Fächer', 'experimenttype' => 'Experimenttypen', 'experiment' => 'Experimente'}.each do |key, value|
    %a.open-link{:href => '#f'+key}=value
    = '|' unless key == 'experiment'
    
  %br
  %br
  
  = render :partial => 'shared/filter_gender'
  = render :partial => 'shared/filter_noshow' 
  = render :partial => 'shared/filter_register' 
  = render :partial => 'shared/filter_begin' 
  = render :partial => 'shared/filter_study' 
  = render :partial => 'shared/filter_experiment_type' 
  = render :partial => 'shared/filter_experiment' 

= hidden_field_tag :sort, params[:sort]
= hidden_field_tag :direction, params[:direction]

.searchinfo
  .right
    = submit_tag "Filter anwenden und Ergebnis aktualisieren", :name => 'submit_mode'
    
  Zeige
  %b= @users.length
  von
  %b= @user_count
  Poolmitgliedern, bereits zugeordnet:
  %b= @participants_count


%hr
%br

.searchnav
  = link_to 'Alle auswählen', '#all', {:class => 'all-link'}
  |
  = link_to 'Alle abwählen', '#none', {:class => 'none-link'}
  |
  = submit_tag "Markierte Poolmitglieder zuordnen", :name => 'submit_marked' 
  |
  = submit_tag "Alle angezeigten Poolmitglieder zuordnen", :name => 'submit_marked', :class => "submit_all" 

%br

- if @users.count > 0
  
  %table
    %tr
      %th
      %th= sortable_for_form 'lastname', 'Name'  
      %th= sortable_for_form 'firstname', 'Vorname'
      %th= sortable_for_form 'email', 'E-Mail'
      %th= sortable_for_form 'study_name', 'Fach'
      %th Gesch.
      %th= sortable_for_form 'begin_date', 'Beginn'
      %th= sortable_for_form 'noshow_count' , "nicht ersch."

    - @users.each do |user| 
      %tr
        %td= check_box_tag "selected_users[#{user.id}]"
        %td= highlight(user.lastname, params[:search])
        %td= highlight(user.firstname, params[:search])
        %td= link_to highlight(truncate(user.email, {:length => 20}), params[:search]), "mailto:#{user.email}"
        %td= truncate(user.study_name, {:length => 20})  
        %td= user.gender
        %td= user.begin_date 
        
        %td
          = user.noshow_count
          = '/'
          = user.participations_count
- else
  %br
  %b
    Kein Poolmitglied gefunden
  %br  
  Entweder wurden bereits alle Poolmitglieder zugeordnet, oder die Filtereinstellungen müssen geändert werden.
  %br
  %br
  %br