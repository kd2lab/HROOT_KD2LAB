= hidden_field_tag :direction, params[:direction]
= hidden_field_tag :sort, params[:sort]

.filter
  Suche in Name, Vorname, E-Mail-Adresse:
  %br
  = text_field_tag :search, params[:search] 
  %br
  %br

  Filter: 
 
  - { 'gender' => 'Geschlecht', 'noshow' => 'Nichterscheinen', 'participated' => 'Teilnahmen', 'role' => 'Rolle', 'begin' => 'Studienbeginn', |
      'study' => 'FÃ¤cher', 'experimenttype' => 'Experimenttypen', 'experiment' => 'Experimente'}.each do |key, value|
    %a.open-link{:href => '#f'+key}=value
    = '|' unless key == 'experiment'
  
 
  %br
  %br


  = render :partial => 'shared/filter_gender'
  = render :partial => 'shared/filter_noshow' 
  = render :partial => 'shared/filter_participated' 
  = render :partial => 'shared/filter_role'
  = render :partial => 'shared/filter_begin' 
  = render :partial => 'shared/filter_study' 
  = render :partial => 'shared/filter_experiment_type' 
  = render :partial => 'shared/filter_experiment' 
  


.searchinfo
  .right
    = submit_tag "Filter anwenden und Ergebnis aktualisieren", :name => 'submit_mode'
  Zeige
  %b= @users.length
  von
  %b= @user_count
  
%hr
%br

%br
%br

- if @users.count > 0
  %table.user-table
    %tr
      %th= sortable_for_form 'lastname', 'Name'  
      %th= sortable_for_form 'firstname', 'Vorname'
      %th= sortable_for_form 'role', 'Rolle'
      %th= sortable_for_form 'email', 'E-Mail'
      %th= sortable_for_form 'study_name', 'Fach'
      %th= sortable_for_form 'gender',  'G.'
      %th= sortable_for_form 'begin_date', 'Beginn'
      %th= sortable_for_form 'created_at', 'Anmeld.'
      %th.qtip_ersch= sortable_for_form 'noshow_count' , '#N'
      %th.qtip_teil= sortable_for_form 'participations_count' , '#T'
      %th

    - @users.each do |user| 
      %tr{:class => if user.deleted then "deleted" end}
        %td= highlight(truncate(user.lastname, {:length => 15}), params[:search])
        %td= highlight(truncate(user.firstname, {:length => 10}), params[:search])
        %td= {'user' => 'P', 'experimenter' => 'E', 'admin' => 'A'}[user.role]
        %td= link_to highlight(truncate(user.email, {:length => 15}), params[:search]), "mailto:#{user.email}"
        %td.study_name_popup{:'data-text' => user.study_name || 'keine Angabe' }
          =user.study_name ? truncate(user.study_name, {:length => 10}) : 'k. A.'
        %td= user.gender
        %td= user.begin_date 
        %td= user.created_at.strftime('%d.%m.%y')
        %td= "#{user.noshow_count}" if user.user?
        %td= "#{user.participations_count}" if user.user?
        
        %td= link_to "Details", user_path(user)
        
- else
  %br
  %b
    Kein User gefunden
  %br  
  %br
  %br
  %br

